<div class="dashboard-wrapper mx-5 my-5">
    <div class="dashboard-container">
  
      <div class="header-card-animated elevation-shadow mb-6">
        <div class="title-action-section flex justify-between items-center">
          <div class="title-block">
            <h2 class="text-black font-bold text-2xl m-0 flex items-center gap-3">
              <i class="bi bi-cash-coin text-green-400"></i>
              GESTIÓN DE COBRANZAS
            </h2>
            <span class="text-gray-300 text-sm mt-1 block">Panel de Recaudación y Seguimiento</span>
          </div>
    
        </div>
      </div>
  
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full mb-6">
          
          <div class="kpi-card glass-effect border-l-4 border-green-500">
              <div class="flex justify-between items-start">
                  <div>
                      <p class="text-gray-500 font-semibold text-sm uppercase">Recaudado Hoy</p>
                      <h3 class="text-3xl font-bold text-slate-800 mt-1">$ 12,450.00</h3>
                  </div>
                  <div class="p-3 bg-green-100 rounded-lg text-green-600">
                      <i class="bi bi-graph-up-arrow text-xl"></i>
                  </div>
              </div>
              <p class="text-xs text-green-600 mt-4 font-medium">
                  <i class="bi bi-caret-up-fill"></i> +15% vs ayer
              </p>
          </div>
  
          <div class="kpi-card glass-effect border-l-4 border-red-500">
              <div class="flex justify-between items-start">
                  <div>
                      <p class="text-gray-500 font-semibold text-sm uppercase">Pólizas en Mora</p>
                      <h3 class="text-3xl font-bold text-slate-800 mt-1">24</h3>
                  </div>
                  <div class="p-3 bg-red-100 rounded-lg text-red-600">
                      <i class="bi bi-exclamation-octagon text-xl"></i>
                  </div>
              </div>
              <p class="text-xs text-red-500 mt-4 font-medium">
                  Acción requerida inmediata
              </p>
          </div>
  
          <div class="kpi-card glass-effect border-l-4 border-blue-500">
              <div class="flex justify-between items-start">
                  <div>
                      <p class="text-gray-500 font-semibold text-sm uppercase">Vencen esta Semana</p>
                      <h3 class="text-3xl font-bold text-slate-800 mt-1">18</h3>
                  </div>
                  <div class="p-3 bg-blue-100 rounded-lg text-blue-600">
                      <i class="bi bi-calendar-week text-xl"></i>
                  </div>
              </div>
              <p class="text-xs text-blue-600 mt-4 font-medium">
                  Enviar recordatorios preventivos
              </p>
          </div>
  
      </div>
  
      <div class="table-card glass-effect elevation-shadow w-full p-6">
        <div class="flex justify-between items-center mb-4">
            <h4 class="text-lg font-bold text-slate-700 m-0">Alertas de Cobro Pendientes</h4>
        </div>
    
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="text-gray-500 border-b border-gray-200 text-sm uppercase">
                    <th class="pb-3 font-semibold">Cliente / Póliza</th>
                    <th class="pb-3 font-semibold">Vencimiento</th>
                    <th class="pb-3 font-semibold">Monto</th>
                    <th class="pb-3 font-semibold">Estado</th>
                    <th class="pb-3 font-semibold">Estado Poliza</th>
                    <th class="pb-3 font-semibold text-right">Acciones</th>
                </tr>
            </thead>
            
            <tbody class="text-slate-700 text-sm">
                
                <tr *ngFor="let item of listaCobranzas" class="border-b border-gray-100 hover:bg-gray-50 transition">
                    
                    <td class="py-4">
                        <div class="font-bold uppercase">{{ item.cliente }}</div>
                        <span class="text-xs text-gray-400">POL: {{ item.poliza }}</span>
                    </td>
    
                    <td class="py-4 font-medium">
                        <div [ngClass]="{'text-red-600': item.diaS_RETRASO > 0, 'text-green-600': item.diaS_RETRASO <= 0}">
                            {{ item.fechA_VENCIMIENTO | date:'dd/MM/yyyy' }}
                        </div>
                        
                        <span class="text-xs" 
                              [ngClass]="{'text-red-400': item.diaS_RETRASO > 0, 'text-gray-400': item.diaS_RETRASO <= 0}">
                            <span *ngIf="item.diaS_RETRASO > 0">Hace {{ item.diaS_RETRASO }} días</span>
                            <span *ngIf="item.diaS_RETRASO == 0">Vence Hoy</span>
                            <span *ngIf="item.diaS_RETRASO < 0">Faltan {{ item.diaS_RETRASO * -1 }} días</span>
                        </span>
                    </td>
    
                    <td class="py-4 font-bold">
                        {{ item.montO_ESPERADO | currency:'USD':'symbol':'1.2-2' }}
                    </td>
    
                    <td class="py-4">
                        <span *ngIf="item.estadO_CALCULADO === 'MORA'" class="badge badge-critical">
                            MORA ALTA
                        </span>
                        
                        <span *ngIf="item.estadO_CALCULADO === 'POR VENCER'" class="badge badge-warning">
                            POR VENCER
                        </span>
    
                        <span *ngIf="item.estadO_CALCULADO === 'AL DIA'" class="badge badge-success">
                            AL DÍA
                        </span>
                        <span *ngIf="item.estadO_CALCULADO === 'PAGADO'" class="badge badge-success">
                            PAGADO
                        </span>
                    </td>

                    <td class="py-4">
                        <span *ngIf="item.estadO_COBRANZA=== 'ANULADO'" class="badge badge-critical">
                            ANULADA
                        </span>
                        
                        <span *ngIf="item.estadO_COBRANZA === 'PENDIENTE'" class="badge badge-warning">
                            PENDIENTE
                        </span>
   <span *ngIf="item.estadO_CALCULADO === 'PAGADO'" class="badge badge-success">
                            PAGADO
                        </span>
                    </td>
    
                    <td class="py-4 text-right flex justify-end gap-2">
                        <button mat-icon-button class="text-blue-600 bg-blue-50" 
                                matTooltip="Enviar Aviso por WhatsApp"
                                (click)="enviarWhatsapp(item)">
                            <i class="bi bi-whatsapp"></i>
                        </button>
                        
                        <button mat-flat-button color="primary" class="h-8 leading-8 px-4 text-xs"
                                (click)="abrirModalCobrar(item)">
                            COBRAR
                        </button>
                        <button mat-icon-button color="warn" 
                             matTooltip="Cancelar Póliza"
                            (click)="confirmarCancelacion(item)">
                            <mat-icon>block</mat-icon> </button>
                    </td>
                </tr>
    
                <tr *ngIf="listaCobranzas.length === 0">
                    <td colspan="5" class="text-center py-10 text-gray-400">
                        <i class="bi bi-inbox text-4xl block mb-2"></i>
                        No hay cobros pendientes por gestionar.
                    </td>
                </tr>
    
            </tbody>
        </table>
    </div>
  
    </div>
  </div>